- name: "‚úÖ Crear organizaci√≥n en VMware Cloud Director (CloudAPI)"
  ansible.builtin.uri:
    url: "{{ vcd.host }}/cloudapi/1.0.0/orgs"
    method: POST
    headers:
      Accept: "application/json;version={{ vcd.api_version }},application/*+json;version={{ vcd.api_version }}"
      Authorization: "Bearer {{ vcd.access_token }}"
      Content-Type: "application/json"
    body_format: json
    body:
      name: "{{ vcd.orgFullName }}"
      displayName: "{{ vcd.orgFullName }}"
      isEnabled: true
      description: "Organizaci√≥n creada autom√°ticamente por Ansible"
    status_code: [200, 201, 409] # 409 si ya existe
    validate_certs: "{{ vcd.verify_ssl }}"
  register: org_create
  changed_when: org_create.status == 201
  failed_when:
    - org_create.status not in [200, 201, 409]

- name: "üîç Mostrar resultado de creaci√≥n de la organizaci√≥n"
  debug:
    msg: >
      {% if org_create.status == 201 %}
        ‚úÖ Organizaci√≥n '{{ vcd.orgFullName }}' creada correctamente.
      {% elif org_create.status == 409 %}
        ‚ö†Ô∏è La organizaci√≥n '{{ vcd.orgFullName }}' ya existe.
      {% else %}
        ‚ùå Error al crear la organizaci√≥n: {{ org_create }}
      {% endif %}